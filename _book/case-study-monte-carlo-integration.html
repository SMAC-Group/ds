<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Let’s find a good title</title>
  <meta name="description" content="LEt’s add somethign here">
<<<<<<< HEAD
  <meta name="generator" content="bookdown 0.4.1 and GitBook 2.6.7">
=======
  <meta name="generator" content="bookdown 0.1.16 and GitBook 2.6.7">
>>>>>>> origin/master

  <meta property="og:title" content="Let’s find a good title" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="LEt’s add somethign here" />
  <meta name="github-repo" content="smac-group/ds" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Let’s find a good title" />
  
  <meta name="twitter:description" content="LEt’s add somethign here" />
  

<meta name="author" content="Stéphane Guerrier, Justin Lee &amp; Roberto Molinari">

<<<<<<< HEAD

<meta name="date" content="2017-07-19">
=======
  
<meta name="date" content="2017-07-17">

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  TeX: { equationNumbers: { autoNumber: "AMS" } }
});
</script>
>>>>>>> origin/master

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="build-a-package.html">
<link rel="next" href="chap-graphs.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">A Minimal Book Example</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a></li>
<li class="chapter" data-level="2" data-path="data.html"><a href="data.html"><i class="fa fa-check"></i><b>2</b> Data Structures</a><ul>
<li class="chapter" data-level="2.1" data-path="data.html"><a href="data.html#vectors"><i class="fa fa-check"></i><b>2.1</b> Vectors</a><ul>
<li class="chapter" data-level="2.1.1" data-path="data.html"><a href="data.html#type"><i class="fa fa-check"></i><b>2.1.1</b> Type</a></li>
<li class="chapter" data-level="2.1.2" data-path="data.html"><a href="data.html#coercion"><i class="fa fa-check"></i><b>2.1.2</b> Coercion</a></li>
<li class="chapter" data-level="2.1.3" data-path="data.html"><a href="data.html#subsetting"><i class="fa fa-check"></i><b>2.1.3</b> Subsetting</a></li>
<li class="chapter" data-level="2.1.4" data-path="data.html"><a href="data.html#vectattr"><i class="fa fa-check"></i><b>2.1.4</b> Attributes</a></li>
<li class="chapter" data-level="2.1.5" data-path="data.html"><a href="data.html#addlab"><i class="fa fa-check"></i><b>2.1.5</b> Adding labels</a></li>
<li class="chapter" data-level="2.1.6" data-path="data.html"><a href="data.html#useful-functions-with-vectors"><i class="fa fa-check"></i><b>2.1.6</b> Useful functions with vectors</a></li>
<li class="chapter" data-level="2.1.7" data-path="data.html"><a href="data.html#creation-sequences"><i class="fa fa-check"></i><b>2.1.7</b> Creation sequences</a></li>
<li class="chapter" data-level="2.1.8" data-path="data.html"><a href="data.html#example-apple-stock-price"><i class="fa fa-check"></i><b>2.1.8</b> Example: Apple Stock Price</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="data.html"><a href="data.html#matrix"><i class="fa fa-check"></i><b>2.2</b> Matrix</a><ul>
<li class="chapter" data-level="2.2.1" data-path="data.html"><a href="data.html#subsetting-1"><i class="fa fa-check"></i><b>2.2.1</b> Subsetting</a></li>
<li class="chapter" data-level="2.2.2" data-path="data.html"><a href="data.html#useful-fun-matrix-algebra"><i class="fa fa-check"></i><b>2.2.2</b> Useful fun + matrix algebra</a></li>
<li class="chapter" data-level="2.2.3" data-path="data.html"><a href="data.html#example-variance-as-matrix"><i class="fa fa-check"></i><b>2.2.3</b> Example: variance as matrix</a></li>
<<<<<<< HEAD
<li class="chapter" data-level="2.2.4" data-path="data.html"><a href="data.html#example-least-squares"><i class="fa fa-check"></i><b>2.2.4</b> Example: Least-squares</a></li>
=======
>>>>>>> origin/master
</ul></li>
<li class="chapter" data-level="2.3" data-path="data.html"><a href="data.html#array"><i class="fa fa-check"></i><b>2.3</b> Array</a></li>
<li class="chapter" data-level="2.4" data-path="data.html"><a href="data.html#list"><i class="fa fa-check"></i><b>2.4</b> List</a></li>
<li class="chapter" data-level="2.5" data-path="data.html"><a href="data.html#dataframe"><i class="fa fa-check"></i><b>2.5</b> Dataframe</a><ul>
<li class="chapter" data-level="2.5.1" data-path="data.html"><a href="data.html#example-making-maps"><i class="fa fa-check"></i><b>2.5.1</b> Example: Making Maps</a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="data.html"><a href="data.html#data-frames"><i class="fa fa-check"></i><b>2.6</b> Data frames</a><ul>
<li class="chapter" data-level="2.6.1" data-path="data.html"><a href="data.html#combination"><i class="fa fa-check"></i><b>2.6.1</b> Combination</a></li>
<li class="chapter" data-level="2.6.2" data-path="data.html"><a href="data.html#subsetting-2"><i class="fa fa-check"></i><b>2.6.2</b> Subsetting</a></li>
<li class="chapter" data-level="2.6.3" data-path="data.html"><a href="data.html#application-non-parametric-bootstrap"><i class="fa fa-check"></i><b>2.6.3</b> Application: Non-parametric bootstrap</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="control.html"><a href="control.html"><i class="fa fa-check"></i><b>3</b> Logical Operators and Control Stuctures</a><ul>
<li class="chapter" data-level="3.1" data-path="control.html"><a href="control.html#logical-operators"><i class="fa fa-check"></i><b>3.1</b> Logical Operators</a></li>
<li class="chapter" data-level="3.2" data-path="control.html"><a href="control.html#control-structures"><i class="fa fa-check"></i><b>3.2</b> Control Structures</a><ul>
<li class="chapter" data-level="3.2.1" data-path="control.html"><a href="control.html#selection-controls"><i class="fa fa-check"></i><b>3.2.1</b> Selection Controls</a></li>
<li class="chapter" data-level="3.2.2" data-path="control.html"><a href="control.html#iteration-controls"><i class="fa fa-check"></i><b>3.2.2</b> Iteration Controls</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="control.html"><a href="control.html#applications"><i class="fa fa-check"></i><b>3.3</b> Applications:</a><ul>
<li class="chapter" data-level="3.3.1" data-path="control.html"><a href="control.html#non-parametric-bootstrap"><i class="fa fa-check"></i><b>3.3.1</b> Non-parametric Bootstrap</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="functions.html"><a href="functions.html"><i class="fa fa-check"></i><b>4</b> Functions</a><ul>
<li class="chapter" data-level="4.1" data-path="functions.html"><a href="functions.html#function-arguments"><i class="fa fa-check"></i><b>4.1</b> Function arguments</a></li>
<li class="chapter" data-level="4.2" data-path="functions.html"><a href="functions.html#function-body"><i class="fa fa-check"></i><b>4.2</b> Function body</a></li>
<li class="chapter" data-level="4.3" data-path="functions.html"><a href="functions.html#function-environment"><i class="fa fa-check"></i><b>4.3</b> Function environment</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="build-a-package.html"><a href="build-a-package.html"><i class="fa fa-check"></i><b>5</b> Build a package</a></li>
<li class="chapter" data-level="6" data-path="case-study-monte-carlo-integration.html"><a href="case-study-monte-carlo-integration.html"><i class="fa fa-check"></i><b>6</b> Case Study: Monte-Carlo Integration</a></li>
<li class="chapter" data-level="7" data-path="chap-graphs.html"><a href="chap-graphs.html"><i class="fa fa-check"></i><b>7</b> Graphics</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Let’s find a good title</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="case-study-monte-carlo-integration" class="section level1">
<h1><span class="header-section-number">Chapter 6</span> Case Study: Monte-Carlo Integration</h1>
<p>Monte Carlo integration is a powerful technique for numerical integration. It is particulary useful to evaluate integrals of “high-dimension”. A detailed (and formal) discussion of this method is clearly beyond the scope of this class and we shall restrict our attention to most basic form(s) of Monte Carlo Integration and breifly discuss the rational behind this method.</p>
<p>Originally, such Monte Carlo methods were known under various names among which <em>statistical sampling</em> was probably the most commonly used. In fact, the name <em>Monte Carlo</em> was popularized by several physics researchers, including Stanislaw Ulam, Enrico Fermi and John von Neumann. The name is believed to be a reference to a famous casino in Monaco where Stanislaw Ulam’s uncle would borrow money to gamble. Enrico Fermi was one of the first to this technique which he employed to study the properties newly-discovered neutron in the 1930s. Later, these methods played for example a central role in many of thesimulations required for the Manhattan project.</p>
<p>Suppose we are interested in computing the following intergal:</p>
<p><span class="math display">\[I = \int_a^b f(x) dx.\]</span></p>
<p>Of course, this integral can be approximated by a Riemann sum,</p>
<p><span class="math display">\[I \approx \Delta x \sum_{i = 1}^n f(a + (i-1) \Delta x),\]</span></p>
<p>where <span class="math inline">\(\Delta x = \frac{b - a}{n}\;\)</span> and the idea behind this approaximation is that as the number of partions <span class="math inline">\(n\)</span> increases the Riemann sum will become closer and closer to <span class="math inline">\(I\)</span>. Also (and under some technical conditions), we have that</p>
<p><span class="math display">\[I = \lim_{n \to \infty} \Delta x \sum_{i = 1}^n f(a + (i-1) \Delta x).\]</span></p>
<p>In fact, the rational of a Monte Carlo Integral is quite close to the Riemann sum since, in its most basic form, we approximate <span class="math inline">\(I\)</span> by averaging samples of the function <span class="math inline">\(f(x)\)</span> at uniform random point within the interval <span class="math inline">\([a, b]\)</span>. Therefore, the Monte Carlo <em>estimator</em> of <span class="math inline">\(I\)</span> is given by</p>
<span class="math display" id="eq:binom">\[\begin{equation} 
\hat{I} = \frac{b - a}{B} \sum_{i = 1}^B f(X_i), 
 \tag{6.1}
\end{equation}\]</span>
<p>where <span class="math inline">\(X_i = a + U_i (b - a)\)</span> and <span class="math inline">\(U_i \sim \mathcal{U}(0,1)\)</span>. In fact, <a href="case-study-monte-carlo-integration.html#eq:binom">(6.1)</a> is quite intuniteve as <span class="math inline">\(\frac{1}{B} \sum_{i = 1}^B f(X_i)\)</span> respresents an estimation of the average value of <span class="math inline">\(f(x)\)</span> in the interval <span class="math inline">\([a, b]\)</span> and thus <span class="math inline">\(\hat{I}\)</span> is simply the average value time the length of the interval, i.e. <span class="math inline">\((b-a)\)</span>.</p>
<p>A more formal argument on the validity of this approach can be found in analysyzing the statistical properties of the estimator <span class="math inline">\(\hat{I}\)</span>. In order to do so, we start by considering its expected value <span class="math display">\[
\mathbb{E}\left[ \hat{I} \right] = \frac{b - a}{B} \sum_{i = 1}^B \mathbb{E}\left[ f(X_i)  \right]
= \frac{b - a}{B} \sum_{i = 1}^B \int f(x) g(x) dx, 
\]</span></p>
<p>where <span class="math inline">\(g(x)\)</span> denotes the pdf of <span class="math inline">\(X_i\)</span>. Since <span class="math inline">\(X_i \sim \mathcal{U}(a, b)\)</span> it follows that</p>
<p><span class="math display">\[
g(x) = \left\{
    \begin{array}{ll}
        \frac{1}{b - a}  &amp; \mbox{if } x \in [a, b] \\
        0 &amp; \mbox{if } x \not\in [a, b]
    \end{array}
\right.
\]</span></p>
<p>Therefore, we have</p>
<p><span class="math display">\[
\mathbb{E}\left[ \hat{I} \right] = \frac{b - a}{B} \sum_{i = 1}^B \int_a^b \frac{f(x)}{b-a} dx = \int_a^b f(x) dx = I, 
\]</span></p>
<p>Since <span class="math inline">\(X_i\)</span> are iid, the same can be said about <span class="math inline">\(f(X_i)\)</span> and therefore by the <strong>Strong Law of Large Numbers</strong> we have that <span class="math inline">\(\hat{I}\)</span> converge <em>almost surely</em> to <span class="math inline">\(I\)</span>, which means that</p>
<p><span class="math display">\[
\mathbb{P}\left(\lim_{B \to \infty} \hat{I} = I    \right) = 1.
\]</span></p>
<p>This result imples that as the number of simulations <span class="math inline">\(B\)</span> goes to infinity we can guarantee that the solution will be exact. Unfortunately, this result does give us any information on how quickly this estimate converges to “sufficiently accurate” solution for the problem at hand. This can be done by studying the variance of <span class="math inline">\(\hat{I}\)</span> and its <em>rate of convergence</em>.</p>
<p><span class="math display">\[
\begin{aligned}
\operatorname{var} \left( \hat{I} \right) &amp;= \left(\frac{b - a}{B}\right)^2  \sum_{i = 1}^B \left\{\mathbb{E}\left[f^2(X_i)\right] - \mathbb{E}^2\left[f(X_i)\right]\right\}\\
&amp;= \frac{1}{B^2} \sum_{i = 1}^B \left\{(b-a) \int_a^b f^2(x) dx - \left(\int_a^b f(x) dx \right)^2 \right\}\\
&amp;= \frac{(b-a) I_2 - I^2}{B}
\end{aligned}
\]</span></p>
<p>where <span class="math inline">\(I_2 = \int_a^b f^2(x) dx\)</span>. A simple estimator of this quantity is given by</p>
<p><span class="math display">\[
\hat{I}_2 = \frac{b - a}{B} \sum_{i = 1}^B f^2(X_i),
\]</span></p>
<p>and therefore using <span class="math inline">\(\hat{I}\)</span> we obtain:</p>
<p><span class="math display">\[
\widehat{\operatorname{var}} \left(\hat{I} \right) = \frac{(b-a) \hat{I}_2 - \hat{I}^2}{B} = \frac{b - a}{B^2} \sum_{i = 1}^B\left[ (b - a )f^2(X_i) - f(X_i)\right]
\]</span></p>
<p>Thus, it is easy to see that the rate of convergence of <span class="math inline">\(\widehat{\operatorname{var}} \left(\hat{I} \right)\)</span> is <span class="math inline">\(B^{-1}\)</span>. This implies that if we wish to reduce the error (or standard deviation) by half we need to quadruple <span class="math inline">\(B\)</span>. Such phenomon is very common in many research such as Statistics is often called the <em>curse of dimensionality</em>.</p>
<p>The function below implements the above precedure and is also available in the <code>stat298</code> package.</p>
<p>There isn’t anything difficult about this code but one thing we haven’t seen yet is how to evaluate a string</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">my_fun =<span class="st"> &quot;x^2&quot;</span>
x =<span class="st"> </span><span class="dv">0</span>:<span class="dv">3</span>
<span class="kw">eval</span>(<span class="kw">parse</span>(<span class="dt">text =</span> my_fun))</code></pre></div>
<pre><code>## [1] 0 1 4 9</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#&#39; Generate random points with bivariate uniform distribution</span>
<span class="co">#&#39; </span>
<span class="co">#&#39; @param x_range A vector of dimension 2 used to denote the parameter </span>
<span class="co">#&#39; of the uniform distribution on the x-axis.</span>
<span class="co">#&#39; @param y_range A vector of dimension 2 used to denote the parameter </span>
<span class="co">#&#39; of the uniform distribution on the y-axis.</span>
<span class="co">#&#39; @param B A positive number used to denote the number of simulation.</span>
<span class="co">#&#39; @param seed A number used to control the seed of the random number</span>
<span class="co">#&#39; generated by this function.</span>
<span class="co">#&#39; @return A B x 2 matrix containing the simulated points.</span>
<span class="co">#&#39; @examples</span>
<span class="co">#&#39; gen_points(x_range = c(0, 1), y_range = c(0, 2), B = 10)</span>
<span class="co">#&#39; gen_points(x_range = c(-10, 1), y_range = c(0, 0.1), B = 5)</span>
monte_carlo_integral_uniform =<span class="st"> </span>function(x_range, fun, B, <span class="dt">seed =</span> <span class="dv">1291</span>){
  <span class="co"># A few checks</span>
  <span class="co"># Check x_range</span>
  if (<span class="kw">length</span>(x_range) !=<span class="st"> </span><span class="dv">2</span> ||<span class="st"> </span>x_range[<span class="dv">1</span>] &gt;=<span class="st"> </span>x_range[<span class="dv">2</span>]){
    <span class="kw">error</span>(<span class="st">&quot;x_range is uncorrely specified&quot;</span>)
  }
  
  <span class="co"># Check fun</span>
  if (<span class="kw">class</span>(fun) !=<span class="st"> &quot;character&quot;</span>){
    <span class="kw">error</span>(<span class="st">&quot;fun is uncorrectly specified and should be a character&quot;</span>)
  }
  
  x =<span class="st"> </span><span class="kw">mean</span>(x_range)
  test_fun =<span class="st"> </span><span class="kw">try</span>(<span class="kw">eval</span>(<span class="kw">parse</span>(<span class="dt">text =</span> fun)), <span class="dt">silent =</span> <span class="ot">TRUE</span>)
  if (<span class="kw">class</span>(test_fun) ==<span class="st"> &quot;try-error&quot;</span>){
    <span class="kw">error</span>(<span class="st">&quot;fun cannot be evaluated&quot;</span>)
  }
  
  <span class="co"># Check B</span>
  if (B &lt;<span class="st"> </span><span class="dv">1</span>){
    <span class="kw">error</span>(<span class="st">&quot;B is uncorrely specified&quot;</span>)
  }
  
  <span class="co"># Set seed</span>
  <span class="kw">set.seed</span>(seed)
  
  <span class="co"># Compute the length of the interval, i.e. (b-a)</span>
  interval_length =<span class="st"> </span><span class="kw">diff</span>(x_range)
  
  <span class="co"># Let&#39;s draw some uniforms to get Ui and Xi</span>
  Ui =<span class="st"> </span><span class="kw">runif</span>(B)
  Xi =<span class="st"> </span>x_range[<span class="dv">1</span>] +<span class="st"> </span>Ui*interval_length
  
  <span class="co"># Compute \hat{I}</span>
  x =<span class="st"> </span>Xi
  I_hat =<span class="st"> </span>interval_length*<span class="kw">mean</span>(<span class="kw">eval</span>(<span class="kw">parse</span>(<span class="dt">text =</span> fun)))
  
  <span class="co"># Compute \hat{I}_2</span>
  I2_hat =<span class="st"> </span>interval_length*<span class="kw">mean</span>((<span class="kw">eval</span>(<span class="kw">parse</span>(<span class="dt">text =</span> fun)))^<span class="dv">2</span>)
  var_I_hat =<span class="st"> </span>(interval_length*I2_hat -<span class="st"> </span>I_hat^<span class="dv">2</span>)/B
  
  <span class="co"># Output list</span>
  out =<span class="st"> </span><span class="kw">list</span>(<span class="dt">I =</span> I_hat, <span class="dt">var =</span> var_I_hat)
  out
}</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">n_step =<span class="st"> </span><span class="dv">10</span>^<span class="dv">3</span>
x =<span class="st"> </span><span class="kw">seq</span>(<span class="dt">from =</span> -<span class="fl">0.35</span>, <span class="dt">to =</span> <span class="fl">3.35</span>, <span class="dt">length.out =</span> n_step)
y =<span class="st"> </span>x^<span class="dv">2</span>
<span class="kw">set.seed</span>(<span class="dv">6</span>)
Ui =<span class="st"> </span><span class="kw">runif</span>(<span class="dv">4</span>, <span class="dv">0</span> ,<span class="dv">3</span>)

<span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">4</span>))



for (i in <span class="dv">1</span>:<span class="dv">4</span>){
  <span class="kw">plot</span>(<span class="ot">NA</span>, <span class="dt">xlim =</span> <span class="kw">range</span>(x), <span class="dt">ylim =</span> <span class="kw">range</span>(y), <span class="dt">xlab =</span> <span class="st">&quot;x&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;f(x)&quot;</span>)
  <span class="kw">grid</span>()
  trans_col =<span class="st"> </span><span class="kw">hcl</span>(<span class="dt">h =</span> <span class="kw">seq</span>(<span class="dv">15</span>, <span class="dv">375</span>, <span class="dt">length =</span> <span class="dv">5</span>), <span class="dt">l =</span> <span class="dv">65</span>, <span class="dt">c =</span> <span class="dv">100</span>, <span class="dt">alpha =</span> <span class="fl">0.15</span>)[<span class="dv">1</span>:<span class="dv">5</span>]
  <span class="kw">lines</span>(x, y, <span class="dt">col =</span> <span class="st">&quot;blue4&quot;</span>)
  <span class="kw">points</span>(Ui[i], Ui[i]^<span class="dv">2</span>, <span class="dt">pch =</span> <span class="dv">16</span>, <span class="dt">col =</span> <span class="st">&quot;yellow2&quot;</span>)
  <span class="kw">polygon</span>(<span class="kw">c</span>(<span class="dv">0</span>, Ui[i], Ui[i], <span class="dv">0</span>), <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, Ui[i]^<span class="dv">2</span>, Ui[i]^<span class="dv">2</span>), 
          <span class="dt">border =</span> <span class="ot">NA</span>, <span class="dt">col =</span> trans_col[i])
}</code></pre></div>
<<<<<<< HEAD
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-72-1.png" width="960" /></p>
=======
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-66-1.png" width="960" /></p>
>>>>>>> origin/master
<p>Example</p>
<p><span class="math display">\[
I = \int_0^3 x^2 dx = \frac{1}{3} \left[x^3\right]_0^3 = 9
\]</span></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">B =<span class="st"> </span><span class="dv">4</span>^(<span class="dv">4</span>:<span class="dv">12</span>)
results =<span class="st"> </span><span class="kw">matrix</span>(<span class="ot">NA</span>, <span class="kw">length</span>(B), <span class="dv">3</span>)
for (i in <span class="dv">1</span>:<span class="kw">length</span>(B)){
  mc_res =<span class="st"> </span><span class="kw">monte_carlo_integral_uniform</span>(<span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">3</span>), <span class="st">&quot;x^2&quot;</span>, <span class="dt">B =</span> B[i], <span class="dt">seed =</span> i<span class="dv">+1</span>)
  results[i, ] =<span class="st"> </span>mc_res$I +<span class="st"> </span><span class="dv">2</span>*<span class="kw">c</span>(<span class="dv">0</span>, <span class="kw">sqrt</span>(mc_res$var), -<span class="kw">sqrt</span>(mc_res$var))
}

trans_blue =<span class="st"> </span><span class="kw">hcl</span>(<span class="dt">h =</span> <span class="kw">seq</span>(<span class="dv">15</span>, <span class="dv">375</span>, <span class="dt">length =</span> <span class="dv">3</span>), <span class="dt">l =</span> <span class="dv">65</span>, <span class="dt">c =</span> <span class="dv">100</span>, <span class="dt">alpha =</span> <span class="fl">0.15</span>)[<span class="dv">2</span>]
<span class="kw">plot</span>(<span class="ot">NA</span>, <span class="dt">xlim =</span> <span class="kw">range</span>(B), <span class="dt">ylim =</span> <span class="kw">range</span>(results[, <span class="dv">2</span>:<span class="dv">3</span>]), <span class="dt">log =</span> <span class="st">&quot;x&quot;</span>, 
     <span class="dt">ylab =</span> <span class="st">&quot;Estimated Integral&quot;</span>, <span class="dt">xlab =</span> <span class="st">&quot;Number of Simulations B&quot;</span>,
     <span class="dt">xaxt =</span> <span class="st">&#39;n&#39;</span>)
<span class="kw">grid</span>()
<span class="kw">axis</span>(<span class="dv">1</span>, <span class="dt">at =</span> B, <span class="dt">labels =</span> <span class="kw">parse</span>(<span class="dt">text =</span> <span class="kw">paste</span>(<span class="st">&quot;4^&quot;</span>, <span class="dv">4</span>:<span class="dv">12</span>, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>)))
<span class="kw">polygon</span>(<span class="kw">c</span>(B, <span class="kw">rev</span>(B)), <span class="kw">c</span>(results[, <span class="dv">2</span>], <span class="kw">rev</span>(results[, <span class="dv">3</span>])), <span class="dt">border =</span> <span class="ot">NA</span>, <span class="dt">col =</span> trans_blue)
<span class="kw">lines</span>(B, results[, <span class="dv">1</span>], <span class="dt">type =</span> <span class="st">&quot;b&quot;</span>, <span class="dt">col =</span> <span class="st">&quot;blue4&quot;</span>, <span class="dt">pch =</span> <span class="dv">16</span>)
<span class="kw">abline</span>(<span class="dt">h =</span> <span class="dv">9</span>, <span class="dt">col =</span> <span class="st">&quot;red4&quot;</span>, <span class="dt">lty =</span> <span class="dv">2</span>)
<span class="kw">legend</span>(<span class="st">&quot;topright&quot;</span>, <span class="kw">c</span>(<span class="kw">expression</span>(I[<span class="dv">1</span>]), <span class="st">&quot;Confidence Interval&quot;</span>, <span class="st">&quot;True Value&quot;</span>), <span class="dt">bty =</span> <span class="st">&quot;n&quot;</span>,
       <span class="dt">pch =</span> <span class="kw">c</span>(<span class="dv">16</span>, <span class="dv">15</span>, <span class="ot">NA</span>), <span class="dt">lwd =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="ot">NA</span>, <span class="dv">1</span>), <span class="dt">lty =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="ot">NA</span>, <span class="dv">2</span>), 
       <span class="dt">pt.cex =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="ot">NA</span>), <span class="dt">col =</span> <span class="kw">c</span>(<span class="st">&quot;blue4&quot;</span>, trans_blue, <span class="st">&quot;red4&quot;</span>))</code></pre></div>
<<<<<<< HEAD
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-73-1.png" width="672" /></p>
=======
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-67-1.png" width="672" /></p>
>>>>>>> origin/master
<p><span class="math display">\[
\widehat{\operatorname{var}} \left(\hat{I} \right) = \mathcal{O}(B^{-1}).
\]</span></p>
<p>The Monte-Carlo approach generalized in the following way. We suppose again that we wish to solve</p>
<p><span class="math display">\[\int_a^b f(x) dx,\]</span></p>
<p>and that <span class="math inline">\(X_i \sim G\)</span> where the pdf of <span class="math inline">\(X_i\)</span> is such that</p>
<p><span class="math display">\[
\max_{\mathbb{R} \setminus [a, b]} \; g(x) = 0 .
\]</span></p>
<p><span class="math display">\[
\tilde{I} = \frac{1}{B}\sum_{i = 1}^B \frac{f(X_i)}{g(X_i)}
\]</span></p>
<p>Of course, in the case <span class="math inline">\(X_i \mathcal{U}(a, b)\)</span>, then <span class="math inline">\(\hat{I}\)</span> and <span class="math inline">\(\hat{I}\)</span> are equivalent.</p>
<p>[ =</p>
<p>]</p>
<p>To understand the very basic idea of Monte Carlo integration we shall start with a simple example. Suppose we wish to compute:</p>
<p><span class="math display">\[
I_1 = \int_{-1}^2 3x^2 dx.
\]</span></p>
<p>It is easy to verify that <span class="math inline">\(\max_{\Omega} \; f(x) = 12\)</span> and <span class="math inline">\(\min_{\Omega} \; f(x) = 0\)</span> where <span class="math inline">\(\Omega = (-1, 2)\)</span> and therefore we have that</p>
<p><span class="math display">\[I_1 \leq I_2 = \int_{-1}^2 \int_{0}^{12} dy dx = 36.\]</span></p>
<p>The following code and image illustrates the situation:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">n_step =<span class="st"> </span><span class="dv">10</span>^<span class="dv">3</span>
x =<span class="st"> </span><span class="kw">seq</span>(<span class="dt">from =</span> -<span class="fl">1.35</span>, <span class="dt">to =</span> <span class="fl">2.35</span>, <span class="dt">length.out =</span> n_step)
x_in_omega =<span class="st"> </span>x[x &gt;=<span class="st"> </span>-<span class="dv">1</span> &amp;<span class="st"> </span>x &lt;=<span class="st"> </span><span class="dv">2</span>]
y =<span class="st"> </span><span class="dv">3</span>*x^<span class="dv">2</span>
col_I1 =<span class="st"> </span><span class="kw">hcl</span>(<span class="dt">h =</span> <span class="kw">seq</span>(<span class="dv">15</span>, <span class="dv">375</span>, <span class="dt">length =</span> <span class="dv">3</span>), <span class="dt">l =</span> <span class="dv">65</span>, <span class="dt">c =</span> <span class="dv">100</span>, <span class="dt">alpha =</span> <span class="fl">0.2</span>)[<span class="dv">2</span>]
<span class="kw">plot</span>(<span class="ot">NA</span>, <span class="dt">xlim =</span> <span class="kw">range</span>(x), <span class="dt">ylim =</span> <span class="kw">range</span>(y), <span class="dt">xlab =</span> <span class="st">&quot;x&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;f(x)&quot;</span>)
<span class="kw">grid</span>()
<span class="kw">polygon</span>(<span class="kw">c</span>(-<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>, -<span class="dv">1</span>), <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">12</span>, <span class="dv">12</span>), <span class="dt">border =</span> <span class="st">&quot;red3&quot;</span>, <span class="dt">lty =</span> <span class="dv">2</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)
<span class="kw">polygon</span>(<span class="kw">c</span>(x_in_omega, <span class="kw">rev</span>(x_in_omega)), <span class="kw">c</span>(<span class="kw">rep</span>(<span class="dv">0</span>, <span class="kw">length</span>(x_in_omega)), 
        <span class="kw">rev</span>(y[x &gt;=<span class="st"> </span>-<span class="dv">1</span> &amp;<span class="st"> </span>x &lt;=<span class="st"> </span><span class="dv">2</span>])), <span class="dt">border =</span> <span class="st">&quot;NA&quot;</span>, <span class="dt">col =</span> col_I1)
<span class="kw">lines</span>(x, y, <span class="dt">col =</span> <span class="st">&quot;blue4&quot;</span>)
<span class="kw">legend</span>(<span class="st">&quot;topleft&quot;</span>, <span class="kw">c</span>(<span class="kw">expression</span>(I[<span class="dv">1</span>]), <span class="kw">expression</span>(I[<span class="dv">2</span>]), <span class="st">&quot;f(x)&quot;</span>), <span class="dt">bty =</span> <span class="st">&quot;n&quot;</span>,
       <span class="dt">pch =</span> <span class="kw">c</span>(<span class="ot">NA</span>, <span class="dv">15</span>, <span class="ot">NA</span>), <span class="dt">lwd =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="ot">NA</span>, <span class="dv">1</span>), <span class="dt">lty =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="ot">NA</span>, <span class="dv">1</span>), 
       <span class="dt">pt.cex =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">2</span>, <span class="ot">NA</span>), <span class="dt">col =</span> <span class="kw">c</span>(<span class="st">&quot;red3&quot;</span>, col_I1, <span class="st">&quot;blue4&quot;</span>))</code></pre></div>
<<<<<<< HEAD
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-74-1.png" width="672" /></p>
=======
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-68-1.png" width="672" /></p>
>>>>>>> origin/master
<p>Suppose that we generate (uniformly) a large number points, with coordinates (<span class="math inline">\(U_1\)</span>, <span class="math inline">\(U_2\)</span>) inside the red region. We assume that <span class="math inline">\(U_1 \sim \mathcal{U}(-1, 2)\)</span> and <span class="math inline">\(U_2 \sim \mathcal{U}(0, 12)\)</span>. The function below also t</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#&#39; Generate random points with bivariate uniform distribution</span>
<span class="co">#&#39; </span>
<span class="co">#&#39; @param x_range A vector of dimension 2 used to denote the parameter </span>
<span class="co">#&#39; of the uniform distribution on the x-axis.</span>
<span class="co">#&#39; @param y_range A vector of dimension 2 used to denote the parameter </span>
<span class="co">#&#39; of the uniform distribution on the y-axis.</span>
<span class="co">#&#39; @param B A positive number used to denote the number of simulation.</span>
<span class="co">#&#39; @param seed A number used to control the seed of the random number</span>
<span class="co">#&#39; generated by this function.</span>
<span class="co">#&#39; @return A B x 2 matrix containing the simulated points.</span>
<span class="co">#&#39; @examples</span>
<span class="co">#&#39; gen_points(x_range = c(0, 1), y_range = c(0, 2), B = 10)</span>
<span class="co">#&#39; gen_points(x_range = c(-10, 1), y_range = c(0, 0.1), B = 5)</span>
gen_points =<span class="st"> </span>function(x_range, y_range, B, <span class="dt">seed =</span> <span class="dv">1291</span>){
  <span class="co"># A few checks</span>
  <span class="co"># Check x_range</span>
  if (<span class="kw">length</span>(x_range) !=<span class="st"> </span><span class="dv">2</span> ||<span class="st"> </span>x_range[<span class="dv">1</span>] &gt;=<span class="st"> </span>x_range[<span class="dv">2</span>]){
    <span class="kw">error</span>(<span class="st">&quot;x_range is uncorrely specified&quot;</span>)
  }
  
  <span class="co"># Check y_range</span>
  if (<span class="kw">length</span>(y_range) !=<span class="st"> </span><span class="dv">2</span> ||<span class="st"> </span>y_range[<span class="dv">1</span>] &gt;=<span class="st"> </span>y_range[<span class="dv">2</span>]){
    <span class="kw">error</span>(<span class="st">&quot;y_range is uncorrely specified&quot;</span>)
  }
  
  <span class="co"># Check B</span>
  if (B &lt;<span class="st"> </span><span class="dv">1</span>){
    <span class="kw">error</span>(<span class="st">&quot;B is uncorrely specified&quot;</span>)
  }
  
  <span class="co"># Set seed</span>
  <span class="kw">set.seed</span>(seed)
  
  <span class="co"># Let&#39;s draw some uniforms</span>
  mat_out =<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">runif</span>(<span class="dv">2</span>*B), B, <span class="dv">2</span>)
  mat_out[, <span class="dv">1</span>] =<span class="st"> </span>mat_out[, <span class="dv">1</span>]*<span class="kw">diff</span>(x_range) +<span class="st"> </span>x_range[<span class="dv">1</span>]
  mat_out[, <span class="dv">2</span>] =<span class="st"> </span>mat_out[, <span class="dv">2</span>]*<span class="kw">diff</span>(y_range) +<span class="st"> </span>y_range[<span class="dv">1</span>]
  mat_out
}</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">B =<span class="st"> </span><span class="dv">500</span>
mc_points =<span class="st"> </span><span class="kw">gen_points</span>(<span class="dt">x_range =</span> <span class="kw">c</span>(-<span class="dv">1</span>, <span class="dv">2</span>), <span class="dt">y_range =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">12</span>), <span class="dt">B =</span> B)
n_step =<span class="st"> </span><span class="dv">10</span>^<span class="dv">3</span>
x =<span class="st"> </span><span class="kw">seq</span>(<span class="dt">from =</span> -<span class="fl">1.35</span>, <span class="dt">to =</span> <span class="fl">2.35</span>, <span class="dt">length.out =</span> n_step)
x_in_omega =<span class="st"> </span>x[x &gt;=<span class="st"> </span>-<span class="dv">1</span> &amp;<span class="st"> </span>x &lt;=<span class="st"> </span><span class="dv">2</span>]
y =<span class="st"> </span><span class="dv">3</span>*x^<span class="dv">2</span>
col_I1 =<span class="st"> </span><span class="kw">hcl</span>(<span class="dt">h =</span> <span class="kw">seq</span>(<span class="dv">15</span>, <span class="dv">375</span>, <span class="dt">length =</span> <span class="dv">3</span>), <span class="dt">l =</span> <span class="dv">65</span>, <span class="dt">c =</span> <span class="dv">100</span>, <span class="dt">alpha =</span> <span class="fl">0.2</span>)[<span class="dv">2</span>]
<span class="kw">plot</span>(<span class="ot">NA</span>, <span class="dt">xlim =</span> <span class="kw">range</span>(x), <span class="dt">ylim =</span> <span class="kw">range</span>(y), <span class="dt">xlab =</span> <span class="st">&quot;x&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;f(x)&quot;</span>)
<span class="kw">grid</span>()
<span class="kw">polygon</span>(<span class="kw">c</span>(-<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>, -<span class="dv">1</span>), <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">12</span>, <span class="dv">12</span>), <span class="dt">border =</span> <span class="st">&quot;red3&quot;</span>, <span class="dt">lty =</span> <span class="dv">2</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)
<span class="kw">polygon</span>(<span class="kw">c</span>(x_in_omega, <span class="kw">rev</span>(x_in_omega)), <span class="kw">c</span>(<span class="kw">rep</span>(<span class="dv">0</span>, <span class="kw">length</span>(x_in_omega)), 
        <span class="kw">rev</span>(y[x &gt;=<span class="st"> </span>-<span class="dv">1</span> &amp;<span class="st"> </span>x &lt;=<span class="st"> </span><span class="dv">2</span>])), <span class="dt">border =</span> <span class="st">&quot;NA&quot;</span>, <span class="dt">col =</span> col_I1)
<span class="kw">lines</span>(x, y, <span class="dt">col =</span> <span class="st">&quot;blue4&quot;</span>)
<span class="kw">points</span>(mc_points, <span class="dt">pch =</span> <span class="dv">19</span>, <span class="dt">cex =</span> <span class="fl">0.5</span>)
<span class="kw">legend</span>(<span class="st">&quot;topleft&quot;</span>, <span class="kw">c</span>(<span class="kw">expression</span>(I[<span class="dv">1</span>]), <span class="kw">expression</span>(I[<span class="dv">2</span>]), <span class="st">&quot;f(x)&quot;</span>), <span class="dt">bty =</span> <span class="st">&quot;n&quot;</span>,
       <span class="dt">pch =</span> <span class="kw">c</span>(<span class="ot">NA</span>, <span class="dv">15</span>, <span class="ot">NA</span>), <span class="dt">lwd =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="ot">NA</span>, <span class="dv">1</span>), <span class="dt">lty =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="ot">NA</span>, <span class="dv">1</span>), 
       <span class="dt">pt.cex =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">2</span>, <span class="ot">NA</span>), <span class="dt">col =</span> <span class="kw">c</span>(<span class="st">&quot;red3&quot;</span>, col_I1, <span class="st">&quot;blue4&quot;</span>))</code></pre></div>
<<<<<<< HEAD
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-76-1.png" width="672" /></p>
=======
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-70-1.png" width="672" /></p>
>>>>>>> origin/master

</div>
            </section>

          </div>
        </div>
      </div>
<a href="build-a-package.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="chap-graphs.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/rstudio/bookdown-demo/edit/master/05-MC.Rmd",
"text": "Edit"
},
"download": ["bookdown-demo.pdf", "bookdown-demo.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(script.src))
      script.src  = script.src.replace(/^https?:/, '');
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
