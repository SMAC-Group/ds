# Functions

This chapter aims at highlighting the main advantages, characteristics, arguments and structure of functions in R. As you already know, a function is a collection of logically connected commands and operations that allow the user to input some arguments and obtain a desired output (based on the given arguments) without having to rewrite the mentioned code each time that specific output is needed. Indeed, a common task in statistical research consists in running some simulation studies which give support (or not) to the use of a certain method of inference. In this case, it's not efficient to rewrite the code each time it is needed within a simulation study because it would lead to lengthy code and increased risk of miss-coding. 

Considering this, in the previous chapter we discussed the non-parametric bootstrap which is a technique used to perform statistical inference in different cases (e.g. small sample sizes, uncertainty on the distribution of the underlying variable, etc.). However, there exist many other types of bootstrap techniques, including the parametric bootstrap which assumes a parametric model for the data (e.g. a Gaussian distribution with mean $\mu$ and variance $\sigma^2$ that represent the parameters). For this bootstrap technique, we assume that we know the underlying model generating the data and therefore estimate its parameters. Once this is done, we use the estimated parameters as if they were the true parameters and use them to simulate from the assumed model. In this manner we generate a parametric bootstrap sample on which we can compute the statistic we are intersted in (e.g. the sample mean), thereby obtaining a distribution for this statistic by simulating many other samples.

What are the advantages of these different inferential methods? Which approach appears to be preferable to the others and under what circumstances? We can run some specific simulation studies to get an idea of the answers to these questions but, to do so, we will need to create functions the implement these methods. The next sections will present the main features of functions in R by studying their main components. R functions have three main components to them:

- *body*: the code lines containing the commands and operations which deliver the desired output;
- *arguments*: the inputs the user gives to the function which will determine the value or type of output of a function;
- *environment*: every R function is built within an enviroment of reference from which to source possible input values and/or other functions necessary for it to work.

While the first component is the collection of commands that we saw in the previous chapters which deliver the output of interest, we will focus more on the last two components by building a function implementing the non-parametric bootstrap to find a confidence interval for the sample mean which we saw in the previous chapter:

```{r}
nonpar_boot <- function(x, B = 500, alpha = 0.05) {
  
  boot_mean <- rep(NA, B)
  n <- length(x)

  for (i in 1:B) {
    
    sample_star <- x[sample(1:n, replace = TRUE)]
    boot_mean[i] <- mean(sample_star)
    
  }

  return(quantile(boot_mean, c(alpha/2, 1 - alpha/2)))
  
}
```

## Function arguments

As you can see, the function's name is "nonpar_boot( )" and it has three arguments to it:

- `x` which represents the original sample on which we would like to perform the bootstrap procedure;
- `B` which represents the number of bootstrap samples we wish to generate;
- `alpha` which determines the size of the confidence interval we wish to compute

The function therefore has three arguments to it and these can be extracted by using the function `formals()`:

```{r}
formals(nonpar_boot)
```

A feature which can be underlined at this stage is that, as can be seen for the above mentioned function, it is possible to provide default values for some, all or none of the function arguments. In this case, default values have been given for the arguments `B` and `alpha`, consequently the user does not need to specify the value of these arguments unless they wish to specify different values compared to the default values given.

```{block2, type='rmdnote'}
R functions are quite flexible when specifying the arguments. These can in fact be specified by exact name, prefix matching or position (and are given priority in this order). For example, one could specify the arguments for the above non-parametric bootstrap function as follows "nonpar_boot(B = 200, sim, a = 0.1)" where the object "sim" is the sample which in the function is named "x". For a more in-depth overview of this feature refer to @wickham2014advanced.
```

The definition of the argument values can be very flexible and can also be defined as functions of other arguments. For example, we could have defined the bootstrap function as follows:

```{r}
nonpar_boot_numb1 <- function(x, B = ceiling(length(x)*alpha), alpha = 0.05) {
  
  boot_mean <- rep(NA, B)
  n <- length(x)

  for (i in 1:B) {
    
    sample_star <- x[sample(1:n, replace = TRUE)]
    boot_mean[i] <- mean(sample_star)
    
  }

  return(list(boot.number = B, boot.quant = quantile(boot_mean, c(alpha/2, 1 - alpha/2))))
  
}

sim <- rnorm(10e3)
nonpar_boot_numb1(sim)$boot.number
```

or define it through variables that are included within the function itself:

```{r}
nonpar_boot_numb2 <- function(x, B = value, alpha = 0.05) {
  
  value <- ceiling(length(x)*alpha)
  boot_mean <- rep(NA, B)
  n <- length(x)

  for (i in 1:B) {
    
    sample_star <- x[sample(1:n, replace = TRUE)]
    boot_mean[i] <- mean(sample_star)
    
  }

  return(list(boot.number = B, boot.quant = quantile(boot_mean, c(alpha/2, 1 - alpha/2))))
  
}

nonpar_boot_numb2(sim)$boot.number
```



## Function environment

## Function attributes
